"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6458],{98714:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>d,contentTitle:()=>c,default:()=>b,frontMatter:()=>l,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"guides/kobo","title":"Read with Kobo","description":"The Kobo integration is based on the native Kobo Sync capability, where your Kobo eReader will sync to a Komga server instead of the official Kobo servers.","source":"@site/docs/guides/kobo.mdx","sourceDirName":"guides","slug":"/guides/kobo","permalink":"/docs/guides/kobo","draft":false,"unlisted":false,"editUrl":"https://github.com/gotson/komga-website/tree/master/website/docs/guides/kobo.mdx","tags":[],"version":"current","lastUpdatedAt":1769493001000,"frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Read with Komelia","permalink":"/docs/guides/komelia"},"next":{"title":"Read with KOReader","permalink":"/docs/guides/koreader"}}');var r=n(62540),s=n(43023),t=n(49479),a=n(22491);const l={},c="Read with Kobo",d={},h=[{value:"Features supported and limitations",id:"features-supported-and-limitations",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Generate API key",id:"generate-api-key",level:3},{value:"Kepubify",id:"kepubify",level:3},{value:"Setup Kobo",id:"setup-kobo",level:3},{value:"Force external port",id:"force-external-port",level:3},{value:"Migrating from Calibre-Web",id:"migrating-from-calibre-web",level:2},{value:"Privacy and Security",id:"privacy-and-security",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Sync fails with <code>Invalid character found in the request target</code>",id:"sync-fails-with-invalid-character-found-in-the-request-target",level:3},{value:"Force Kobo Sync",id:"force-kobo-sync",level:3},{value:"Access Kobo eReader logs",id:"access-kobo-ereader-logs",level:3},{value:"Komga logs",id:"komga-logs",level:3}];function u(e){const o={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.header,{children:(0,r.jsx)(o.h1,{id:"read-with-kobo",children:"Read with Kobo"})}),"\n",(0,r.jsx)(o.p,{children:"The Kobo integration is based on the native Kobo Sync capability, where your Kobo eReader will sync to a Komga server instead of the official Kobo servers."}),"\n",(0,r.jsx)(o.h2,{id:"features-supported-and-limitations",children:"Features supported and limitations"}),"\n",(0,r.jsx)(o.p,{children:"This is what is currently supported:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["Only ",(0,r.jsx)(o.strong,{children:"EPUB"})," books from all libraries, along with their metadata and cover image, will be synced."]}),"\n",(0,r.jsx)(o.li,{children:"When books metadata or cover is edited in Komga, they will be updated on the Kobo eReader."}),"\n",(0,r.jsx)(o.li,{children:"When books are deleted in Komga, they will be deleted on the Kobo eReader."}),"\n",(0,r.jsx)(o.li,{children:"Read progress is synced both ways"}),"\n",(0,r.jsxs)(o.li,{children:["EPUB books will be converted to KEPUB on-the-fly when downloaded by the Kobo, if Kepubify is configured and available (see ",(0,r.jsx)(o.a,{href:"#kepubify",children:"Kepubify"}),")"]}),"\n",(0,r.jsxs)(o.li,{children:["If Kobo proxying is enabled in ",(0,r.jsx)(o.em,{children:"Server Settings"}),", Komga will relay requests to the official Kobo servers, and return both the Komga content and Kobo content to the Kobo eReader. This can be useful if you have official Kobo purchases."]}),"\n"]}),"\n",(0,r.jsx)(o.p,{children:"Read progress syncs in the following way:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"For pre-paginated books, the read progress will be accurate per page."}),"\n",(0,r.jsx)(o.li,{children:"For regular EPUB books, Kobo can only keep track of read progress at the beginning of a chapter, not within a chapter. Mid-chapter read progress will be lost when switching from Kobo to Komga or Komga to Kobo. This is a Kobo limitation."}),"\n",(0,r.jsx)(o.li,{children:"For Kobo EPUB (KEPUB) books, Kobo uses its own mechanism to track progress. Komga does its best to map the Kobo specific read progress to Komga, but it may be off by a few pages."}),"\n"]}),"\n",(0,r.jsx)(o.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(o.p,{children:["In order to use Kobo Sync with Komga, a Komga user must have the roles ",(0,r.jsx)(o.code,{children:"KOBO_SYNC"})," and ",(0,r.jsx)(o.code,{children:"FILE_DOWNLOAD"}),"."]}),"\n",(0,r.jsxs)(o.p,{children:["Proxying of unknown requests to the official Kobo servers can be enabled in ",(0,r.jsx)(o.em,{children:"Server Settings"}),". This is enabled globally for all users on the server."]}),"\n",(0,r.jsx)(o.h3,{id:"generate-api-key",children:"Generate API key"}),"\n",(0,r.jsxs)(o.p,{children:["The Kobo Sync Komga API uses a dedicated set of endpoints which require an API key to be accessed. Users can generate API keys from the ",(0,r.jsx)(o.em,{children:"Account Settings"})," page. Make sure to write down the generated key, as it won't be shown afterwards."]}),"\n",(0,r.jsx)(o.p,{children:"If you have multiple Kobo devices, it is recommended to use a different API key for each."}),"\n",(0,r.jsx)(o.h3,{id:"kepubify",children:"Kepubify"}),"\n",(0,r.jsxs)(o.p,{children:["Komga uses ",(0,r.jsx)(o.a,{href:"https://pgaskin.net/kepubify/",children:"Kepubify"})," to automatically convert EPUB books to KEPUB when the Kobo requests a file."]}),"\n",(0,r.jsx)(o.p,{children:"Kepubify is bundled on the following distributions:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"Windows app"}),"\n",(0,r.jsx)(o.li,{children:"macOS app"}),"\n",(0,r.jsx)(o.li,{children:"Docker amd64"}),"\n",(0,r.jsx)(o.li,{children:"Docker arm64"}),"\n",(0,r.jsx)(o.li,{children:"Docker arm"}),"\n"]}),"\n",(0,r.jsxs)(o.p,{children:["When using the ",(0,r.jsx)(o.code,{children:"jar"}),", you will need to configure the path to ",(0,r.jsx)(o.code,{children:"kepubify"})," or ",(0,r.jsx)(o.code,{children:"kepubify.exe"})," from the ",(0,r.jsx)(o.em,{children:"Server Settings"}),"."]}),"\n",(0,r.jsx)(o.h3,{id:"setup-kobo",children:"Setup Kobo"}),"\n",(0,r.jsxs)(o.p,{children:["Connect your Kobo eReader to your computer and open the ",(0,r.jsx)(o.code,{children:".kobo/Kobo/Kobo eReader.conf"})," file (you may need to display hidden files on Mac/Linux)."]}),"\n",(0,r.jsx)(o.p,{children:"The file should contain the following line (among others):"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{children:"api_endpoint=https://storeapi.kobo.com\n"})}),"\n",(0,r.jsxs)(o.p,{children:["If the line does not exist, it must be created under the ",(0,r.jsx)(o.code,{children:"[OneStoreServices]"})," group."]}),"\n",(0,r.jsx)(o.p,{children:"You will need to replace this line with your external server address, in the following form:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{children:"api_endpoint=https://<your_komga_address>/kobo/<api_key>\n"})}),"\n",(0,r.jsx)(o.p,{children:"For example:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{children:"api_endpoint=https://demo.komga.org/kobo/ABC123456123ABCD\n"})}),"\n",(0,r.jsx)(o.p,{children:"Or for a local connection (adjust the port as needed):"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{children:"api_endpoint=http://192.168.1.54:25600/kobo/ABC123456123ABCD\n"})}),"\n",(0,r.jsx)(o.h3,{id:"force-external-port",children:"Force external port"}),"\n",(0,r.jsxs)(o.p,{children:["The Kobo eReader does not send valid HTTP ",(0,r.jsx)(o.code,{children:"Host"})," header, which could break the covers and file download in certain circumstances.  Komga will try its best to automatically fix the incorrect Kobo headers, but in some specific cases it's not possible."]}),"\n",(0,r.jsxs)(o.p,{children:["If you experience some issues downloading covers or files from the Kobo, you will need to configure the ",(0,r.jsx)(o.em,{children:"Kobo Sync external port"})," (in ",(0,r.jsx)(o.em,{children:"Server Settings"}),") to the port that your Kobo is accessing. Normally it should be what you have configured in ",(0,r.jsx)(o.code,{children:"api_endpoint"}),"."]}),"\n",(0,r.jsx)(o.p,{children:"A case where this would be required is if you access your Komga server directly (without a reverse proxy), with Komga running in Docker, and with a Docker mapped port that is different from the internal Komga port."}),"\n",(0,r.jsx)(o.h2,{id:"migrating-from-calibre-web",children:"Migrating from Calibre-Web"}),"\n",(0,r.jsxs)(o.p,{children:["If you have used Calibre-Web with Kobo Sync before, you can migrate to Komga by changing the ",(0,r.jsx)(o.code,{children:"Kobo eReader.conf"})," and point to your Komga server instead."]}),"\n",(0,r.jsx)(o.p,{children:"Books added by Calibre-Web should remain on your Kobo device."}),"\n",(0,r.jsx)(o.p,{children:"If you have Kobo proxying enabled, Komga is able to extract your Kobo authentication tokens from the Calibre-Web token (stored on the Kobo) transparently."}),"\n",(0,r.jsx)(o.h2,{id:"privacy-and-security",children:"Privacy and Security"}),"\n",(0,r.jsx)(o.p,{children:"The Kobo eReader sends out sensitive information during the Sync protocol. It is highly recommended to only use Kobo Sync over HTTPS."}),"\n",(0,r.jsx)(o.p,{children:"The API key is as sensitive as your username and password. Since the API key is part of the URL for Kobo Sync, you should not share this URL with anyone."}),"\n",(0,r.jsx)(o.p,{children:"Be careful when sharing Komga logs or Kobo logs, and redact any sensitive information."}),"\n",(0,r.jsx)(o.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(o.h3,{id:"sync-fails-with-invalid-character-found-in-the-request-target",children:["Sync fails with ",(0,r.jsx)(o.code,{children:"Invalid character found in the request target"})]}),"\n",(0,r.jsx)(o.p,{children:"The Kobo does not respect the HTTP standards when sending requests. If your Kobo is configured to connect to Komga directly, the sync will fail, and the Komga logs will contain a message like:"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-log",children:"java.lang.IllegalArgumentException: Invalid character found in the request target [/kobo/abcdefdf8e0f24842a514c37d133e2ff3/v1/assets?DiffRequests=[%7BKey:EPD-KoboPlus-ReadOnly-NeverSubscribed,ETag:%7D] ]. The valid characters are defined in RFC 7230 and RFC 3986\n"})}),"\n",(0,r.jsx)(o.p,{children:"You can configure Komga to allow for those invalid characters:"}),"\n",(0,r.jsxs)(t.A,{children:[(0,r.jsxs)(a.default,{value:"yaml",label:"Application.yml",children:[(0,r.jsxs)(o.p,{children:["Add the following key in your ",(0,r.jsx)(o.code,{children:"application.yml"}),":"]}),(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-yaml",children:'server.tomcat.relaxed-query-chars: "[,]"\n'})})]}),(0,r.jsxs)(a.default,{value:"env",label:"Docker",children:[(0,r.jsx)(o.p,{children:"Set the following environment variable:"}),(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-shell",children:"SERVER_TOMCAT_RELAXEDQUERYCHARS=[,]\n"})})]})]}),"\n",(0,r.jsx)(o.h3,{id:"force-kobo-sync",children:"Force Kobo Sync"}),"\n",(0,r.jsxs)(o.p,{children:["If the Kobo eReader becomes out of sync with Komga somehow, you can force a full sync from the ",(0,r.jsx)(o.em,{children:"Account Settings"})," page. Locate the API key, and click the ",(0,r.jsx)(o.em,{children:"Force Kobo sync"})," icon."]}),"\n",(0,r.jsx)(o.h3,{id:"access-kobo-ereader-logs",children:"Access Kobo eReader logs"}),"\n",(0,r.jsx)(o.p,{children:"Logs on the Kobo device are encrypted and cannot be read when connecting the device to a computer."}),"\n",(0,r.jsx)(o.p,{children:"In order to get readable logs, you will need to enable Developer options:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["in the search bar, type ",(0,r.jsx)(o.code,{children:"devmodeon"})," and search"]}),"\n",(0,r.jsxs)(o.li,{children:["it will not show any search results, but you will be able to access Developer options under ",(0,r.jsx)(o.em,{children:"Settings > Device Information > Developer options"})]}),"\n",(0,r.jsxs)(o.li,{children:["In the ",(0,r.jsx)(o.em,{children:"Logging Category"})," section, enable the following: ",(0,r.jsx)(o.code,{children:"sync"}),", ",(0,r.jsx)(o.code,{children:"packetdump"})]}),"\n",(0,r.jsx)(o.li,{children:"Restart the Kobo eReader"}),"\n"]}),"\n",(0,r.jsxs)(o.p,{children:["Once that's set, you will be able to stream the Kobo's logs using netcat. Use the following command on a computer that is on the same network as the Kobo. Replace ",(0,r.jsx)(o.code,{children:"<kobo IP address>"})," with the actual IP of your Kobo."]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-shell",children:"nc -v <kobo IP address> 5001\n"})}),"\n",(0,r.jsx)(o.h3,{id:"komga-logs",children:"Komga logs"}),"\n",(0,r.jsxs)(o.p,{children:["Komga can log all incoming HTTP requests, including headers and body, by setting ",(0,r.jsx)(o.code,{children:"logging.level.org.springframework.web.filter.CommonsRequestLoggingFilter"})," to ",(0,r.jsx)(o.code,{children:"DEBUG"}),"."]}),"\n",(0,r.jsxs)(o.p,{children:["To log outgoing HTTP requests to the official Kobo Store, set ",(0,r.jsx)(o.code,{children:"logging.level.org.gotson.komga.infrastructure.kobo"})," to ",(0,r.jsx)(o.code,{children:"DEBUG"}),"."]}),"\n",(0,r.jsxs)(o.p,{children:["You can also access the recent HTTP exchanges under the ",(0,r.jsx)(o.code,{children:"/actuator/httpexchanges"})," endpoint on your Komga server."]})]})}function b(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},49479:(e,o,n)=>{n.d(o,{A:()=>b});var i=n(63696),r=n(11750),s=n(90766),t=n(75373),a=n(86681);const l={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var c=n(62540);function d({className:e,block:o,selectedValue:n,selectValue:i,tabValues:t}){const a=[],{blockElementScrollPositionUntilNextRender:d}=(0,s.a_)(),h=e=>{const o=e.currentTarget,r=a.indexOf(o),s=t[r].value;s!==n&&(d(o),i(s))},u=e=>{let o=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{const n=a.indexOf(e.currentTarget)+1;o=a[n]??a[0];break}case"ArrowLeft":{const n=a.indexOf(e.currentTarget)-1;o=a[n]??a[a.length-1];break}}o?.focus()};return(0,c.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":o},e),children:t.map((({value:e,label:o,attributes:i})=>(0,c.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{a.push(e)},onKeyDown:u,onClick:h,...i,className:(0,r.A)("tabs__item",l.tabItem,i?.className,{"tabs__item--active":n===e}),children:o??e},e)))})}function h({lazy:e,children:o,selectedValue:n}){const s=(Array.isArray(o)?o:[o]).filter(Boolean);if(e){const e=s.find((e=>e.props.value===n));return e?(0,i.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,c.jsx)("div",{className:"margin-top--md",children:s.map(((e,o)=>(0,i.cloneElement)(e,{key:o,hidden:e.props.value!==n})))})}function u(e){const o=(0,t.u)(e);return(0,c.jsxs)("div",{className:(0,r.A)("tabs-container",l.tabList),children:[(0,c.jsx)(d,{...o,...e}),(0,c.jsx)(h,{...o,...e})]})}function b(e){const o=(0,a.default)();return(0,c.jsx)(u,{...e,children:(0,t.v)(e.children)},String(o))}}}]);